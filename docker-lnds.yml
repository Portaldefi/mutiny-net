version: "3.7"

x-logging-lnds: &default-lnds-logging
  driver: "json-file"
  options:
    max-size: "50m"
    max-file: "3"

  lnd:
    container_name: "lnd"
    image: lightninglabs/lnd:v0.18.2-beta
    user: "0:1000"
    logging: *default-lnds-logging
    restart: always
    stop_grace_period: 10m
    environment:
      RPCPASSWORD: $RPCPASSWORD
    command: [
        "--bitcoin.active",
        "--bitcoin.signet",
        "--bitcoin.node=bitcoind",
        # "--maxpendingchannels=10",
        "--rpclisten=0.0.0.0:10009",
        "--restlisten=0.0.0.0:8081",
        "--bitcoind.rpchost=bitcoind:38332",
        "--bitcoind.rpcuser=bitcoin",
        "--bitcoind.rpcpass=$RPCPASSWORD",
        "--bitcoind.zmqpubrawblock=tcp://bitcoind:28332",
        "--bitcoind.zmqpubrawtx=tcp://bitcoind:28333",
        "--db.bolt.auto-compact",
        "--db.prune-revocation",
        "--alias=Portal Faucet LND",
        # "--externalip=mutinynet.com",
        # "--externalip=gfg7fwat27mnsmlog7wbgi6a53f2b5rj56bwokcfk45bacnb4z5kt5ad.onion",
        "--tlsextradomain=lp1.$SUBDOMAIN",
        "--tlsextradomain=lnd",
        "--protocol.option-scid-alias",
        "--protocol.wumbo-channels",
        "--accept-keysend",
        "--minchansize=25000",
        "--noseedbackup",
        "--gc-canceled-invoices-on-startup",
        "--coin-selection-strategy=random",
        "--protocol.custom-message=513",
        "--protocol.custom-nodeann=39",
        "--protocol.custom-init=39",
      ]
    volumes:
      - ~/volumes/.lnd:/root/.lnd
    ports:
      - "9735:9735"
      - "10009:10009"
      - "8081:8081"
    ulimits:
      nproc: 65535
      nofile:
        soft: 1000000
        hard: 1000000
